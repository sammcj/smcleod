<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title class=pjax-title>Broadcom, Or How I Learned To Start Worrying And Drop The Packet - smcleod.net</title><meta name=Description content><meta property="og:title" content="Broadcom, Or How I Learned To Start Worrying And Drop The Packet"><meta property="og:description" content="Earlier this week we started the process to upgrade one of our hypervisor compute clusters when we encountered a rather painful bug with HP&rsquo;s Broadcom NIC chipsets.
We were part way through a routine rolling pool upgrade of our hypervisor (XenServer) cluster when we observed unexpected and intermittent loss of connectivity between several VMs, then entire XenServer hosts.
The problems appeared to impact hosts that hadn&rsquo;t yet upgraded to XenServer 7.2. We now attribute this to a symptom of extreme packet loss between the hosts in the pool and thanks to buggy firmware from Broadcom and HP.
We were aware of the recently published issues with Broadcom/HP NICs used in VMware clusters where NICs would be bricked by a firmware upgrade."><meta property="og:type" content="article"><meta property="og:url" content="https://beta.smcleod.net/2017/10/broadcom-or-how-i-learned-to-start-worrying-and-drop-the-packet/"><meta property="og:image" content="https://beta.smcleod.net/apple-touch-icon.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-10-13T00:00:00+00:00"><meta property="article:modified_time" content="2022-10-31T15:04:28+11:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://beta.smcleod.net/apple-touch-icon.png"><meta name=twitter:title content="Broadcom, Or How I Learned To Start Worrying And Drop The Packet"><meta name=twitter:description content="Earlier this week we started the process to upgrade one of our hypervisor compute clusters when we encountered a rather painful bug with HP&rsquo;s Broadcom NIC chipsets.
We were part way through a routine rolling pool upgrade of our hypervisor (XenServer) cluster when we observed unexpected and intermittent loss of connectivity between several VMs, then entire XenServer hosts.
The problems appeared to impact hosts that hadn&rsquo;t yet upgraded to XenServer 7.2. We now attribute this to a symptom of extreme packet loss between the hosts in the pool and thanks to buggy firmware from Broadcom and HP.
We were aware of the recently published issues with Broadcom/HP NICs used in VMware clusters where NICs would be bricked by a firmware upgrade."><meta name=application-name content="smcleod.net"><meta name=apple-mobile-web-app-title content="smcleod.net"><meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=../../../logo.svg><link rel=apple-touch-icon sizes=180x180 href=../../../apple-touch-icon.png><link rel=mask-icon href=../../../safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://beta.smcleod.net/2017/10/broadcom-or-how-i-learned-to-start-worrying-and-drop-the-packet/><link rel=prev href=https://beta.smcleod.net/2017/09/glusterfs/><link rel=next href=https://beta.smcleod.net/2017/10/applying-syntax-in-sublime-based-on-the-first-file-line/><link rel=stylesheet href=../../../lib/normalize/normalize.min.8235a67a2521ef99fb1e455a5891b022af1653b4ede3cfffcac4e473beee88fbcc1a36bbb3cfdd75fd6df46732032f9d96e30adae9c88b769e1fbf7945cd27e0.css integrity="sha512-gjWmeiUh75n7HkVaWJGwIq8WU7Tt48//ysTkc77uiPvMGja7s8/ddf1t9GcyAy+dluMK2unIi3aeH795Rc0n4A=="><link rel=stylesheet href=../../../css/style.min.18108d84e024a889c14d785ff688fe13b654fa9bdc1118490c01fd2d42d6d7ae133fc32040282141aa703a4581fc715573ddde9fdb5f6520fbace1c06f846cd0.css integrity="sha512-GBCNhOAkqInBTXhf9oj+E7ZU+pvcERhJDAH9LULW164TP8MgQCghQapwOkWB/HFVc93en9tfZSD7rOHAb4Rs0A=="><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=../../../lib/fontawesome-free/all.min.eb8387c9eb0ab6d4fa4d7ad397d15df13b92c009a1eb221b757dd1ecfccabc78a4c5b681847a7f4198ff7cd60abed8300508c9dea138cd1f4a85f09f09b2092a.css integrity="sha512-64OHyesKttT6TXrTl9Fd8TuSwAmh6yIbdX3R7PzKvHikxbaBhHp/QZj/fNYKvtgwBQjJ3qE4zR9KhfCfCbIJKg=="><noscript><link rel=stylesheet href=../../../lib/fontawesome-free/all.min.eb8387c9eb0ab6d4fa4d7ad397d15df13b92c009a1eb221b757dd1ecfccabc78a4c5b681847a7f4198ff7cd60abed8300508c9dea138cd1f4a85f09f09b2092a.css integrity="sha512-64OHyesKttT6TXrTl9Fd8TuSwAmh6yIbdX3R7PzKvHikxbaBhHp/QZj/fNYKvtgwBQjJ3qE4zR9KhfCfCbIJKg=="></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=../../../lib/animate/animate.min.738daa4d2c3fc0f677ff92c1cc3f81c397fb6d2176a31a2eeb011bf88fe5a9e68a57914321f32fbd1a7bef6cb88dc24b2ae1943a96c931d83f053979d1f25803.css integrity="sha512-c42qTSw/wPZ3/5LBzD+Bw5f7bSF2oxou6wEb+I/lqeaKV5FDIfMvvRp772y4jcJLKuGUOpbJMdg/BTl50fJYAw=="><noscript><link rel=stylesheet href=../../../lib/animate/animate.min.738daa4d2c3fc0f677ff92c1cc3f81c397fb6d2176a31a2eeb011bf88fe5a9e68a57914321f32fbd1a7bef6cb88dc24b2ae1943a96c931d83f053979d1f25803.css integrity="sha512-c42qTSw/wPZ3/5LBzD+Bw5f7bSF2oxou6wEb+I/lqeaKV5FDIfMvvRp772y4jcJLKuGUOpbJMdg/BTl50fJYAw=="></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Broadcom, Or How I Learned To Start Worrying And Drop The Packet","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/beta.smcleod.net\/2017\/10\/broadcom-or-how-i-learned-to-start-worrying-and-drop-the-packet\/"},"image":["https:\/\/beta.smcleod.net\/apple-touch-icon.png"],"genre":"posts","keywords":"tech, networking, hardware","wordcount":1236,"url":"https:\/\/beta.smcleod.net\/2017\/10\/broadcom-or-how-i-learned-to-start-worrying-and-drop-the-packet\/","datePublished":"2017-10-13T00:00:00+00:00","dateModified":"2022-10-31T15:04:28+11:00","license":"Sam McLeod","publisher":{"@type":"Organization","name":"Sam McLeod"},"author":{"@type":"Person","name":"Sam McLeod"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark")}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else"auto"==="light"||"auto"==="dark"||"auto"==="black"?(setTheme("auto"),saveTheme("auto")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")]</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=../../../ title=smcleod.net><img class="lazyload logo" data-src=../../../logo.svg data-srcset="../../../logo.svg, ../../../logo.svg 1.5x, ../../../logo.svg 2x" data-sizes=auto alt=/logo.svg title=/logo.svg>smcleod.net</a></div><div class=menu><div class=menu-inner><a class=menu-item href=../../../posts/>üìù Posts </a><a class=menu-item href=../../../categories/>üç± Categories </a><a class=menu-item href=../../../series/>üìö Series </a><a class=menu-item href=../../../links/ title="Links to software and services I use">üîó Links </a><a class=menu-item href=../../../about/ title="Sam McLeod">ü§¶üèª‚Äç‚ôÇÔ∏è About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=# onclick=return!1 class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=# onclick=return!1 class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=# onclick=return!1 class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=../../../ title=smcleod.net><img class="lazyload logo" data-src=../../../logo.svg data-srcset="../../../logo.svg, ../../../logo.svg 1.5x, ../../../logo.svg 2x" data-sizes=auto alt=/logo.svg title=/logo.svg>smcleod.net</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=# onclick=return!1 class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=# onclick=return!1 class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=# onclick=return!1 class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=../../../posts/ title>üìù Posts</a><a class=menu-item href=../../../categories/ title>üç± Categories</a><a class=menu-item href=../../../series/ title>üìö Series</a><a class=menu-item href=../../../links/ title="Links to software and services I use">üîó Links</a><a class=menu-item href=../../../about/ title="Sam McLeod">ü§¶üèª‚Äç‚ôÇÔ∏è About</a><a href=# onclick=return!1 class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class="toc-content always-active" id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#downgrading-the-firmware>Downgrading The Firmware</a></li><li><a href=#xenserver>XenServer</a></li><li><a href=#workaround>Workaround</a></li><li><a href=#bnx2x-driver>BNX2X Driver</a></li><li><a href=#affected-components>Affected Components</a></li><li><a href=#links>Links</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle","normal")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Broadcom, Or How I Learned To Start Worrying And Drop The Packet</h1><div class=post-meta><div class=post-meta-line><span class=post-author><i class="author fas fa-user-circle fa-fw"></i><a href=https://github.com/sammcj title=Author target=_blank rel="noopener noreferrer author" class=author>Sam McLeod</a>
</span>&nbsp;<span class=post-category>included in </span>&nbsp;<span class=post-category>category <a href=../../../categories/tech/><i class="far fa-folder fa-fw"></i>Tech</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2017-10-13>2017-10-13</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2022-10-31>2022-10-31</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1236 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;6 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#downgrading-the-firmware>Downgrading The Firmware</a></li><li><a href=#xenserver>XenServer</a></li><li><a href=#workaround>Workaround</a></li><li><a href=#bnx2x-driver>BNX2X Driver</a></li><li><a href=#affected-components>Affected Components</a></li><li><a href=#links>Links</a></li></ul></nav></div></div><div class=content id=content><p>Earlier this week we started the process to upgrade one of our hypervisor compute clusters when we encountered a rather painful bug with HP&rsquo;s Broadcom NIC chipsets.</p><p>We were part way through a routine rolling pool upgrade of our hypervisor (XenServer) cluster when we observed unexpected and intermittent loss of connectivity between several VMs, then entire XenServer hosts.</p><p>The problems appeared to impact hosts that hadn&rsquo;t yet upgraded to XenServer 7.2. We now attribute this to a symptom of extreme packet loss between the hosts in the pool and thanks to buggy firmware from Broadcom and HP.</p><p>We were aware of the <a href=http://www.thevirtualist.org/bricked-qlogic-broadcom-bcm57840-driver-update/ target=_blank rel="noopener noreferrer">recently published issues</a> with Broadcom/HP NICs used in VMware clusters where NICs would be <a href="https://h20566.www2.hpe.com/hpsc/doc/public/display?docId=a00027033en_us" target=_blank rel="noopener noreferrer">bricked by a firmware upgrade</a>. This issue is different from what we experienced.</p><p>We experienced extreme packet loss between hosts in the cluster. With XenServer, the pool master must be upgraded first. The result was that XAPI pool management suffered a communication breakdown across the management network and complicated diagnosis. In fact, the connectivity problems went unnoticed until many hours after the master was upgraded.</p><p>At first appeared as if it was a problem caused by the pool being partially upgraded.</p><p>We wondered if we had perhaps made a poor decision to run the upgrade on a single node for a few hours to observe its performance. We made the call to upgrade another host and analyse our findings.</p><p>The next upgraded hosts appeared stable. In fact we later found this host wasn&rsquo;t impacted by the bug. We then made the call to upgrade several more nodes and continue to track their stability.</p><p>After upgrading half the pool, we suddenly hit problems. VMs failed, Hosts started dropping out of the pool and losing track of the power state of running/stopped VMs.</p><p>We found that the master along with one of the other hosts were experiencing major packet loss on their management network cards. We suspected faulty NICs as it wouldn&rsquo;t be the first time a Broadcom had failed us and there is no physical network cabling.</p><p>Broadcom has had its fair share of bad press over the years. Many botched firmware updates and proprietary driver issues. I&rsquo;m recommending people to stay clear from using network cards based on their chipsets.</p><h2 id=downgrading-the-firmware class=headerLink><a href=#downgrading-the-firmware class=header-mark></a>Downgrading The Firmware</h2><p>As soon as we spotted the packet loss on the Broadcom NICs we upgraded their firmware to <a href=http://downloads.linux.hpe.com/SDR/repo/spp/RHEL/7/x86_64/current/firmware-nic-qlogic-nx2-2.19.22-1.1.x86_64.rpm target=_blank rel="noopener noreferrer">2.19.22-1</a> with no improvement.
We then upgraded to <a href=http://downloads.linux.hpe.com/SDR/repo/spp/RHEL/7/x86_64/current/hp-firmware-nic-qlogic-nx2-2.18.44-1.1.x86_64.rpm target=_blank rel="noopener noreferrer">2.18.44-1 / 7.14.62</a> again with no improvement.
We even went as far as trying <a href=http://downloads.linux.hpe.com/SDR/repo/spp/RHEL/7/x86_64/current/hp-firmware-nic-qlogic-nx2-2.16.20-1.1.x86_64.rpm target=_blank rel="noopener noreferrer">2.16.20 / 7.12.83</a> from back in 2015 - but still no luck.</p><p>At the time of writing this no firmware downgrades (or upgrades) have fixed the issue.</p><p>The packet loss manifests itself immediately after rebooting or power cycling. But - <em>not on every reboot!</em>. This is the odd thing - approximately half the time when booting a host it is fine until the next boot.</p><p>We&rsquo;ve compared the <code>dmesg</code>, <code>lspci</code> and <code>modinfo</code> output between boot cycles, we can&rsquo;t find anything that stands out.</p><p>The bug seems to be caused by the version of the <code>bnx2x</code> driver present in XenServer 7.2&rsquo;s Kernel. Upon further reading HP recommends that you use bnx2x driver 7.14.29-2 or later, XenServer still uses the old Kernel version of 4.4.0 - that&rsquo;s not currently an option.</p><p>I suspect that it&rsquo;s a bug in the Broadcom firmware loaded into the NIC upon boot.
I suspect a race condition related to the devices interrupt handling (MSI/MSI-X).</p><h2 id=xenserver class=headerLink><a href=#xenserver class=header-mark></a>XenServer</h2><p>XenServer needs to update its kernel or at least the bnx2x driver module past the version that triggers the bug. I&rsquo;ve logged a ticket for this over at <a href=https://bugs.xenserver.org/browse/XSO-808 target=_blank rel="noopener noreferrer">bugs.xenserver.org</a></p><p>Additionally, XenServer didn&rsquo;t notice the packet loss/network interruptions during the rolling pool upgrade. I have reported this concern and have suggested that XenServer adds pool wide checks for connectivity issues between hosts, at <em>least</em> during a pool upgrade.</p><h2 id=workaround class=headerLink><a href=#workaround class=header-mark></a>Workaround</h2><p>We don&rsquo;t have (a good) one.</p><p>Currently we&rsquo;re simply testing for packet loss after boot on the management NIC. If detected we reboot the host and check again. This far from ideal - but until the bug is resolved there isn&rsquo;t any other fix that we can find short of compiling a custom module for XenServer 7.2.</p><p>Given the widespread problems with Broadcom, we&rsquo;ve ordered HP 560M, Intel based NICs to replace them.</p><h2 id=bnx2x-driver class=headerLink><a href=#bnx2x-driver class=header-mark></a>BNX2X Driver</h2><p>The driver included with XenServer 7.2 that triggers the problem is <code>1.714.1</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>filename:       /lib/modules/4.4.0+10/updates/bnx2x.ko
</span></span><span class=line><span class=cl>version:        1.714.1
</span></span><span class=line><span class=cl>license:        GPL
</span></span><span class=line><span class=cl>#description:   QLogic BCM57710/57711/57711E/57712/57712_MF/57800/57800_MF/57810/57810_MF/57840/57840_MF Driver
</span></span><span class=line><span class=cl>author:         Eliezer Tamir
</span></span><span class=line><span class=cl>srcversion:     927337210F53311B18D0D7E
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000163Fsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000163Esv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000163Dsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v00001077d000016ADsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016ADsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v00001077d000016A4sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016A4sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016ABsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016AFsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016A2sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v00001077d000016A1sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016A1sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000168Dsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016AEsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000168Esv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016A9sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016A5sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000168Asv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000166Fsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d00001663sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d00001662sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d00001650sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000164Fsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000164Esv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>depends:        mdio,libcrc32c,ptp,vxlan
</span></span><span class=line><span class=cl>vermagic:       4.4.0+10 SMP mod_unload modversions
</span></span><span class=line><span class=cl>parm:           pri_map: Priority to HW queue mapping (uint)
</span></span><span class=line><span class=cl>parm:           num_queues: Set number of queues (default is as a number of CPUs) (int)
</span></span><span class=line><span class=cl>parm:           disable_iscsi_ooo: Disable iSCSI OOO support (uint)
</span></span><span class=line><span class=cl>parm:           disable_tpa: Disable the TPA (LRO) feature (uint)
</span></span><span class=line><span class=cl>parm:           int_mode: Force interrupt mode other than MSI-X (1 INT#x; 2 MSI) (uint)
</span></span><span class=line><span class=cl>parm:           dropless_fc: Pause on exhausted host ring (uint)
</span></span><span class=line><span class=cl>parm:           poll: Use polling (for debug) (uint)
</span></span><span class=line><span class=cl>parm:           mrrs: Force Max Read Req Size (0..3) (for debug) (int)
</span></span><span class=line><span class=cl>parm:           debug: Default debug msglevel (uint)
</span></span><span class=line><span class=cl>parm:           num_vfs: Number of supported virtual functions (0 means SR-IOV is disabled) (uint)
</span></span><span class=line><span class=cl>parm:           autogreeen: Set autoGrEEEn (0:HW default; 1:force on; 2:force off) (uint)
</span></span><span class=line><span class=cl>parm:           native_eee:int
</span></span><span class=line><span class=cl>parm:           eee:set EEE Tx LPI timer with this value; 0: HW default; -1: Force disable EEE.
</span></span><span class=line><span class=cl>parm:           tx_switching: Enable tx-switching (uint)
</span></span></code></pre></div><p>Whereas XenServer 7.0 has driver version <code>1.713.04</code> which seems not to trigger the issue:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>filename:       /lib/modules/3.10.0+10/extra/bnx2x.ko
</span></span><span class=line><span class=cl>version:        1.713.04
</span></span><span class=line><span class=cl>license:        GPL
</span></span><span class=line><span class=cl>#description:   QLogic BCM57710/57711/57711E/57712/57712_MF/57800/57800_MF/57810/57810_MF/57840/57840_MF Driver
</span></span><span class=line><span class=cl>author:         Eliezer Tamir
</span></span><span class=line><span class=cl>srcversion:     13EAA521200A40118055D63
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000163Fsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000163Esv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000163Dsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v00001077d000016ADsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016ADsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v00001077d000016A4sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016A4sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016ABsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016AFsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016A2sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v00001077d000016A1sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016A1sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000168Dsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016AEsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000168Esv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016A9sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d000016A5sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000168Asv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000166Fsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d00001663sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d00001662sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d00001650sv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000164Fsv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>alias:          pci:v000014E4d0000164Esv*sd*bc*sc*i*
</span></span><span class=line><span class=cl>depends:        mdio,libcrc32c,ptp
</span></span><span class=line><span class=cl>vermagic:       3.10.0+10 SMP mod_unload modversions
</span></span><span class=line><span class=cl>parm:           pri_map: Priority to HW queue mapping (uint)
</span></span><span class=line><span class=cl>parm:           num_queues: Set number of queues (default is as a number of CPUs) (int)
</span></span><span class=line><span class=cl>parm:           disable_iscsi_ooo: Disable iSCSI OOO support (uint)
</span></span><span class=line><span class=cl>parm:           disable_tpa: Disable the TPA (LRO) feature (uint)
</span></span><span class=line><span class=cl>parm:           int_mode: Force interrupt mode other than MSI-X (1 INT#x; 2 MSI) (uint)
</span></span><span class=line><span class=cl>parm:           dropless_fc: Pause on exhausted host ring (uint)
</span></span><span class=line><span class=cl>parm:           poll: Use polling (for debug) (uint)
</span></span><span class=line><span class=cl>parm:           mrrs: Force Max Read Req Size (0..3) (for debug) (int)
</span></span><span class=line><span class=cl>parm:           debug: Default debug msglevel (uint)
</span></span><span class=line><span class=cl>parm:           num_vfs: Number of supported virtual functions (0 means SR-IOV is disabled) (uint)
</span></span><span class=line><span class=cl>parm:           autogreeen: Set autoGrEEEn (0:HW default; 1:force on; 2:force off) (uint)
</span></span><span class=line><span class=cl>parm:           native_eee:int
</span></span><span class=line><span class=cl>parm:           eee:set EEE Tx LPI timer with this value; 0: HW default; -1: Force disable EEE.
</span></span><span class=line><span class=cl>parm:           tx_switching: Enable tx-switching (uint)
</span></span></code></pre></div><h2 id=affected-components class=headerLink><a href=#affected-components class=header-mark></a>Affected Components</h2><ul><li><a href="https://www.hpe.com/h20195/v2/getpdf.aspx/c04111538.pdf?ver=3" target=_blank rel="noopener noreferrer">HP 530M Network cards</a> (as they use the Broadcom bcm57810 chipset), commonly found in BL460c Gen8 blades and similar.</li><li>XenServer 7.2 (Patched to the latest XS72E006 patch)</li><li>Kernel 4.4.0+10 as found in XenServer 7.2</li><li>Broadcom bnx2x module version 1.714.1</li><li><a href="http://h20564.www2.hpe.com/hpsc/swd/public/detail?swItemId=MTX_3bc2b88453424d87b7543d6459" target=_blank rel="noopener noreferrer">HP firmware for qlogic nx2</a> (seemingly all versions)</li></ul><h2 id=links class=headerLink><a href=#links class=header-mark></a>Links</h2><ul><li><a href=http://blog.serverfault.com/post/broadcom-die-mutha/ target=_blank rel="noopener noreferrer">Broadcom, Die Mutha</a></li><li><a href=http://www.thevirtualist.org/bricked-qlogic-broadcom-bcm57840-driver-update/ target=_blank rel="noopener noreferrer">Bricked QLogic Broadcom BCM57840 after driver update</a></li><li><a href="https://www.hpe.com/h20195/v2/getpdf.aspx/c04111538.pdf?ver=3" target=_blank rel="noopener noreferrer">HP Flex-10 10Gb 2-port 530M Adapter</a></li><li><a href="https://h20566.www2.hpe.com/hpsc/doc/public/display?docId=a00027033en_us" target=_blank rel="noopener noreferrer">HPE Network Adapters - Updating The BNX2X Driver Package Version 2.713.30 On VMware Hosts With Certain Network Adapters Running Certain Firmware May Require A Network Adapter Replacement</a></li><li><a href="http://h20564.www2.hpe.com/hpsc/swd/public/detail?swItemId=MTX_19bc1fb428d4400a90d59a7175#tab-history" target=_blank rel="noopener noreferrer">HP Qlogic NX2 Firmware</a></li></ul></div><h2>Related Content</h2><div class=related-container><div class=related-item-container><div class=related-image><a href=../../../2022/10/making-work-visible-avoid-dms/><img class=lazyload data-src=../../../2022/10/making-work-visible-avoid-dms/dm-disruption.jpg data-srcset="../../../2022/10/making-work-visible-avoid-dms/dm-disruption.jpg, ../../../2022/10/making-work-visible-avoid-dms/dm-disruption.jpg 1.5x, ../../../2022/10/making-work-visible-avoid-dms/dm-disruption.jpg 2x" data-sizes=auto alt=/2022/10/making-work-visible-avoid-dms/dm-disruption.jpg title=/2022/10/making-work-visible-avoid-dms/dm-disruption.jpg height=200 width=400></a></div><h2 class=related-title><a href=../../../2022/10/making-work-visible-avoid-dms/>Making Work Visible - Avoid DMs</a></h2></div><div class=related-item-container><div class=related-image><a href=../../../2021/07/rancilio-silvia-upgrade/><img class=lazyload data-src=../../../2021/07/rancilio-silvia-upgrade/assembled_preview.jpeg data-srcset="../../../2021/07/rancilio-silvia-upgrade/assembled_preview.jpeg, ../../../2021/07/rancilio-silvia-upgrade/assembled_preview.jpeg 1.5x, ../../../2021/07/rancilio-silvia-upgrade/assembled_preview.jpeg 2x" data-sizes=auto alt=/2021/07/rancilio-silvia-upgrade/assembled_preview.jpeg title=/2021/07/rancilio-silvia-upgrade/assembled_preview.jpeg height=200 width=400></a></div><h2 class=related-title><a href=../../../2021/07/rancilio-silvia-upgrade/>Rancilio Silvia Upgrade</a></h2></div><div class=related-item-container><div class=related-image><a href=../../../2019/08/camels-dressed-as-unicorns/><img class=lazyload data-src=../../../2019/08/camels-dressed-as-unicorns/camel_corn.jpeg data-srcset="../../../2019/08/camels-dressed-as-unicorns/camel_corn.jpeg, ../../../2019/08/camels-dressed-as-unicorns/camel_corn.jpeg 1.5x, ../../../2019/08/camels-dressed-as-unicorns/camel_corn.jpeg 2x" data-sizes=auto alt=/2019/08/camels-dressed-as-unicorns/camel_corn.jpeg title=/2019/08/camels-dressed-as-unicorns/camel_corn.jpeg height=200 width=400></a></div><h2 class=related-title><a href=../../../2019/08/camels-dressed-as-unicorns/>Camels Dressed As Unicorns</a></h2></div><div class=related-item-container><div class=related-image><a href=../../../2019/08/looking-for-new-opportunities/><img class=lazyload data-src=../../../2019/08/looking-for-new-opportunities/fiji_aws_prac_training_1.jpg data-srcset="../../../2019/08/looking-for-new-opportunities/fiji_aws_prac_training_1.jpg, ../../../2019/08/looking-for-new-opportunities/fiji_aws_prac_training_1.jpg 1.5x, ../../../2019/08/looking-for-new-opportunities/fiji_aws_prac_training_1.jpg 2x" data-sizes=auto alt=/2019/08/looking-for-new-opportunities/fiji_aws_prac_training_1.jpg title=/2019/08/looking-for-new-opportunities/fiji_aws_prac_training_1.jpg height=200 width=400></a></div><h2 class=related-title><a href=../../../2019/08/looking-for-new-opportunities/>Looking For New Opportunities</a></h2></div><div class=related-item-container><div class=related-image><a href=../../../2019/06/leaving-infoxchange/><img class=lazyload data-src=../../../2019/06/leaving-infoxchange/road-no-car-2048.jpg data-srcset="../../../2019/06/leaving-infoxchange/road-no-car-2048.jpg, ../../../2019/06/leaving-infoxchange/road-no-car-2048.jpg 1.5x, ../../../2019/06/leaving-infoxchange/road-no-car-2048.jpg 2x" data-sizes=auto alt=/2019/06/leaving-infoxchange/road-no-car-2048.jpg title=/2019/06/leaving-infoxchange/road-no-car-2048.jpg height=200 width=400></a></div><h2 class=related-title><a href=../../../2019/06/leaving-infoxchange/>Leaving Infoxchange</a></h2></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-10-31&nbsp;<a class=git-hash href=https://github.com/sammcj/smcleod-hugo/commit/28c2c547888f2ba4282f805d20e3bc774697430d target=_blank title="commit by Sam McLeod(sammcj@users.noreply.github.com) 28c2c547888f2ba4282f805d20e3bc774697430d: A new start" rel="noopener noreferrer">
<i class="fas fa-hashtag fa-fw"></i>28c2c54</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-mardown href=../../../2017/10/broadcom-or-how-i-learned-to-start-worrying-and-drop-the-packet/index.md target=_blank rel="noopener noreferrer">Read markdown</a>
</span><span>|&nbsp;<a class=link-to-edit href=https://github.com/sammcj/smcleod-hugo/edit/main/content/posts/2017-10-13-Drop-Broadcom/index.md target=_blank rel="noopener noreferrer">Edit this page</a></span></div><div class=post-info-share><span><a href=# onclick=return!1 title="Share on Twitter" data-sharer=twitter data-url=https://beta.smcleod.net/2017/10/broadcom-or-how-i-learned-to-start-worrying-and-drop-the-packet/ data-title="Broadcom, Or How I Learned To Start Worrying And Drop The Packet" data-via=s_mcleod data-hashtags=tech,networking,hardware><i class="fab fa-twitter fa-fw"></i></a><a href=# onclick=return!1 title="Share on Linkedin" data-sharer=linkedin data-url=https://beta.smcleod.net/2017/10/broadcom-or-how-i-learned-to-start-worrying-and-drop-the-packet/><i class="fab fa-linkedin fa-fw"></i></a><a href=# onclick=return!1 title="Share on Hacker News" data-sharer=hackernews data-url=https://beta.smcleod.net/2017/10/broadcom-or-how-i-learned-to-start-worrying-and-drop-the-packet/ data-title="Broadcom, Or How I Learned To Start Worrying And Drop The Packet"><i class="fab fa-hacker-news fa-fw"></i></a><a href=# onclick=return!1 title="Share on Reddit" data-sharer=reddit data-url=https://beta.smcleod.net/2017/10/broadcom-or-how-i-learned-to-start-worrying-and-drop-the-packet/><i class="fab fa-reddit fa-fw"></i></a><a href=# onclick=return!1 title="Share on Pocket" data-sharer=pocket data-url=https://beta.smcleod.net/2017/10/broadcom-or-how-i-learned-to-start-worrying-and-drop-the-packet/><i class="fab fa-get-pocket fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=../../../tags/tech/>tech</a>,&nbsp;<a href=../../../tags/networking/>networking</a>,&nbsp;<a href=../../../tags/hardware/>hardware</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=../../../>Home</a></span></section></div><div class=post-nav><a href=../../../2017/09/glusterfs/ class=prev rel=prev title=GlusterFS><i class="fas fa-angle-left fa-fw"></i>GlusterFS</a>
<a href=../../../2017/10/applying-syntax-in-sublime-based-on-the-first-file-line/ class=next rel=next title="Applying syntax in Sublime based on the first file line">Applying syntax in Sublime based on the first file line<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2010 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/sammcj target=_blank rel="noopener noreferrer">Sam McLeod</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=../../../atkinson-hyperlegible/atkinson-hyperlegible.eab28ad9966784d2ce9271970fa9cde34de4a323c0e4cd22fb5ffbf5261b049f52e236f1c06684c0ba73f72454f180c6e9e4667bee6cec7e9d5ac2d9dcb7b24e.css integrity="sha512-6rKK2ZZnhNLOknGXD6nN403koyPA5M0i+1/79SYbBJ9S4jbxwGaEwLpz9yRU8YDG6eRme+5s7H6dWsLZ3LeyTg=="><noscript><link rel=stylesheet href=../../../atkinson-hyperlegible/atkinson-hyperlegible.eab28ad9966784d2ce9271970fa9cde34de4a323c0e4cd22fb5ffbf5261b049f52e236f1c06684c0ba73f72454f180c6e9e4667bee6cec7e9d5ac2d9dcb7b24e.css integrity="sha512-6rKK2ZZnhNLOknGXD6nN403koyPA5M0i+1/79SYbBJ9S4jbxwGaEwLpz9yRU8YDG6eRme+5s7H6dWsLZ3LeyTg=="></noscript><script type=text/javascript src=../../../lib/autocomplete/autocomplete.min.0dcc8ee301dccbd9fb18115a1176e1293ca233b99aee5f5d12f218463c34eccea29f842827fc1ce330cf26e1e21b1382725ad3d0703cbde9f7e28552bcd92c07.js integrity="sha512-DcyO4wHcy9n7GBFaEXbhKTyiM7ma7l9dEvIYRjw07M6in4QoJ/wc4zDPJuHiGxOCclrT0HA8ven34oVSvNksBw=="></script><script type=text/javascript src=../../../lib/fuse/fuse.min.3dd1499ec34f39e57a4363bb184754a5023e0f9c47115d67dbec47058d78fb562f0c929c84d44a0a1ca7f84ed73b907e40fa84995338a66677721853139fb70f.js integrity="sha512-PdFJnsNPOeV6Q2O7GEdUpQI+D5xHEV1n2+xHBY14+1YvDJKchNRKChyn+E7XO5B+QPqEmVM4pmZ3chhTE5+3Dw=="></script><script type=text/javascript src=../../../lib/lazysizes/lazysizes.min.ab9f37a692ab09173b3793b49f69f352227eb2e52fec4b752467a5b386d739a30541c6a63e4f478dd5249d9bae16304db3bb6c32e69d81ee64f51cdd98efb519.js integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ=="></script><script type=text/javascript src=../../../lib/topbar/topbar.min.db5613fde0d014e29123106077225a764bdb4bdf791c2d252c1db5c09f19ea0bd181d29e10a1c03fddc6b0666d83ed17645ee84c31fb405fc7c0b8b38fd95eb0.js integrity="sha512-21YT/eDQFOKRIxBgdyJadkvbS995HC0lLB21wJ8Z6gvRgdKeEKHAP93GsGZtg+0XZF7oTDH7QF/HwLizj9lesA=="></script><script type=text/javascript src=../../../lib/pjax/pjax.min.8f92ba6fd6079d25aa09e1be3b1e3568438eba0fa53a093eb559684245a9c227d65e346122eb048ee9439ac9af9ce653c1ed88f20305c6121e946035c42705b0.js integrity="sha512-j5K6b9YHnSWqCeG+Ox41aEOOug+lOgk+tVloQkWpwifWXjRhIusEjulDmsmvnOZTwe2I8gMFxhIelGA1xCcFsA=="></script><script type=text/javascript src=../../../js/theme.min.js defer></script></div><div class=pjax-assets><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:100},comment:{},search:{distance:100,findAllMatches:!0,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:3,noResultsFound:"No results found",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!0},sharerjs:!0}</script><script type=text/javascript src=../../../lib/clipboard/clipboard.min.b08a94127467df50609e03e61edd897a7ce57830ec5f060efa2caf438e8cc3a44bfae7405198f69ffbbf3c663cd0dc51c729ceed1f71206c792c4cf0e0835625.js integrity="sha512-sIqUEnRn31BgngPmHt2JenzleDDsXwYO+iyvQ46Mw6RL+udAUZj2n/u/PGY80NxRxynO7R9xIGx5LEzw4INWJQ=="></script><script type=text/javascript src=../../../lib/sharer/sharer.min.cab91d53e60c836a90e16a5091059006925296eeed2c665fc744b7e7755ec3ab5c4e58e3c83899af70d8f690e004c2ca62062e11b0c7efdced87f80d074cfa3e.js integrity="sha512-yrkdU+YMg2qQ4WpQkQWQBpJSlu7tLGZfx0S353Vew6tcTljjyDiZr3DY9pDgBMLKYgYuEbDH79zth/gNB0z6Pg=="></script></div></body></html>